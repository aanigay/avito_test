# Тестовое задание в Авито
## Нигай Александр

Все дополнительные задания выполнены

### Запуск программы
``
docker-compose up --build
``

Примеры запросов находятся в экспортированной коллекции Postman
*avito.postman_collection.json*

Для удобства при инициализации БД в таблицу пользователей добавляется 10 записей

Пользователи и сегменты находятся в разных таблицах, *users_segments* - таблица связей

Логирование операций удаления и добавления в сегменты осуществлено с помощью триггеров PostgreSQL
(решил, что так будет элегантнее чем писать серверный код для трекинга каждой операции, 
особенно трудно это было сделать, учитывая TTL). 
После составления отчета по определенному месяцу (формат строго YYYY-MM) предоставляется ссылка на скачивание файла прямо с хоста.

Для очищения таблицы по TTL'у написал простого воркера, который с некоторой периодичностью очищает таблицу users_segments 
от записей с устаревшим TTL. Периодичность задается в переменной окружения TTL_CHECK_PERIOD в формате числа и единицы измерения времени
(например: "5m", "1d" и т.п., валидные форматы перечислены здесь https://pkg.go.dev/maze.io/x/duration#ParseDuration) 

При создании сегмента с автоматическим добавлением пользователей в поле *percent* указывается процент от всех пользователей, которые попадут в этот сегмент, 
значение *percent* строго от 1 до 100, пользователи выбираются случайно.

